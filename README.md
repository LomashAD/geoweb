# GeoWeb

Веб-приложение для управления сельскохозяйственными полями с функциями геоучета, расчета экономики и рекомендаций по севообороту на основе нейронных сетей.

## Описание

GeoWeb — это комплексная система для управления сельскохозяйственными полями, которая позволяет:

- Отслеживать поля на интерактивной карте
- Ведение истории посевов по каждому полю
- Расчет экономической эффективности культур с учетом севооборота
- Получение рекомендаций по выбору культур на основе машинного обучения

## Основные возможности

### Управление полями
- Создание, редактирование и удаление полей
- Отображение полей на интерактивной карте (Leaflet)
- Хранение геометрических данных полей в формате GeoJSON

### История посевов
- Ведение истории посевов по каждому полю
- Фильтрация по полям и годам
- Отслеживание сезонов и заметок

### Экономический калькулятор
- Расчет прибыльности культур с учетом площади
- Учет влияния севооборота на урожайность и затраты
- Детальная разбивка расходов (семена, удобрения, прочие расходы)
- Расчет доходности и рентабельности

### Рекомендательная система
- Нейронная сеть на основе Random Forest для рекомендаций
- Учет климатической зоны, типа почвы и истории посевов
- Рекомендации по севообороту, удобрениям и защите растений
- Определение климатической зоны по координатам поля

## Технологический стек

- **Backend**: Flask 3.0.0
- **База данных**: SQLite (с возможностью перехода на PostgreSQL)
- **ORM**: Flask-SQLAlchemy 3.1.1
- **Машинное обучение**: scikit-learn 1.3.2
- **Обработка данных**: pandas 2.1.4, numpy 1.24.3
- **Frontend**: HTML, CSS, JavaScript
- **Карты**: Leaflet.js

## Установка

### Требования

- Python 3.8 или выше
- pip

### Шаги установки

1. Клонируйте репозиторий:
```bash
git clone https://github.com/yourusername/geoweb.git
cd geoweb
```

2. Создайте виртуальное окружение:
```bash
python -m venv venv
```

3. Активируйте виртуальное окружение:

   Windows:
   ```bash
   venv\Scripts\activate
   ```

   Linux/Mac:
   ```bash
   source venv/bin/activate
   ```

4. Установите зависимости:
```bash
pip install -r requirements.txt
```

5. Создайте файл `.env` в корне проекта (опционально):
```env
SECRET_KEY=your-secret-key-here
```

Если файл `.env` не создан, будет использован ключ по умолчанию (не рекомендуется для production).

6. Инициализируйте базу данных:
```bash
python utils.py
```

Или запустите приложение, база данных создастся автоматически при первом запуске.

7. Запустите приложение:
```bash
python app.py
```

Приложение будет доступно по адресу: `http://localhost:5000`

## Структура проекта

```
GeoWeb/
├── app.py                      # Главный файл приложения Flask
├── config.py                   # Конфигурация базы данных и приложения
├── models.py                   # Модели данных (Field, Crop, CropHistory)
├── calculator_api.py           # API для экономических расчетов
├── neural_network_recommender.py  # Модуль рекомендаций на основе ML
├── utils.py                    # Утилиты для инициализации БД
├── requirements.txt            # Зависимости проекта
├── crop_climate_data.csv      # Данные для обучения модели
├── templates/                  # HTML шаблоны
│   ├── base.html
│   ├── index.html
│   ├── fields.html
│   ├── history.html
│   └── calculator.html
├── static/                    # Статические файлы
│   ├── css/
│   │   └── style.css
│   └── js/
│       ├── common.js
│       ├── index.js
│       ├── fields.js
│       ├── history.js
│       └── calculator.js
└── README.md                   # Этот файл
```

## API Endpoints

### Поля
- `GET /api/fields` - Получить список всех полей
- `POST /api/fields` - Создать новое поле
- `PUT /api/fields/<id>` - Обновить поле
- `DELETE /api/fields/<id>` - Удалить поле

### Культуры
- `GET /api/crops` - Получить список всех культур

### История посевов
- `GET /api/crop-history?field_id=<id>` - Получить историю посевов
- `POST /api/crop-history` - Добавить запись в историю
- `DELETE /api/crop-history/<id>` - Удалить запись из истории

### Рекомендации
- `GET /api/field-recommendation?field_id=<id>` - Получить рекомендацию для поля

### Калькулятор
- `POST /api/calculate` - Рассчитать экономику культуры
- `GET /api/calculator/prices/crops` - Получить текущие цены на культуры
- `GET /api/calculator/crops/<crop_name>` - Получить детали культуры для калькулятора

## Использование

### Добавление поля

1. Перейдите на страницу "Поля"
2. Нажмите "Добавить поле"
3. Нарисуйте контур поля на карте или введите координаты
4. Укажите название и площадь поля
5. Сохраните

### Ведение истории посевов

1. Перейдите на страницу "История"
2. Выберите поле из списка
3. Добавьте запись о посеве: культура, год, сезон
4. При необходимости добавьте заметки

### Расчет экономики

1. Перейдите на страницу "Калькулятор"
2. Выберите культуру из списка
3. Укажите площадь поля
4. При необходимости выберите предшествующую культуру
5. Нажмите "Рассчитать"
6. Просмотрите детальный расчет прибыльности

### Получение рекомендаций

1. На главной странице отображаются рекомендации для всех полей
2. Рекомендации генерируются автоматически на основе:
   - История посевов на поле
   - Климатическая зона (определяется по координатам)
   - Тип почвы
   - Правила севооборота

## Обучение модели

Модель машинного обучения обучается автоматически при первом запуске приложения. Обучение происходит на основе данных из файла `crop_climate_data.csv`.

Для переобучения модели можно вызвать метод `train()` класса `CropRecommender`:

```python
from neural_network_recommender import recommender
recommender.train()
```

## Конфигурация базы данных

По умолчанию используется SQLite. Для перехода на PostgreSQL:

1. Установите `psycopg2-binary` (уже в requirements.txt)
2. Измените функцию `get_database_url()` в `config.py`:

```python
def get_database_url() -> str:
    return os.getenv('DATABASE_URL', 'postgresql://user:password@localhost/geoweb')
```

## Разработка

### Запуск в режиме разработки

```bash
python app.py
```

Приложение запустится в режиме отладки на порту 5000.

### Проверка базы данных

```bash
python utils.py check
```

## Лицензия

Этот проект распространяется под лицензией MIT. См. файл LICENSE для подробностей.

## Вклад в проект

Вклад в проект приветствуется! Пожалуйста:

1. Сделайте fork проекта
2. Создайте ветку для новой функции (`git checkout -b feature/AmazingFeature`)
3. Закоммитьте изменения (`git commit -m 'Add some AmazingFeature'`)
4. Запушьте в ветку (`git push origin feature/AmazingFeature`)
5. Откройте Pull Request

## Авторы

Стародубов Владимир, Евсеенко Роман, Лиходедов Александр

Сделано для  хакатона и UMIRHack
